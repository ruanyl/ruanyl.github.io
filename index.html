<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Bigruan Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Bigruan Blog">
<meta property="og:url" content="http://blog.bigruan.com/index.html">
<meta property="og:site_name" content="Bigruan Blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Bigruan Blog">
<meta name="twitter:description">
  
  
    <link rel="icon" href="/favicon.png">
  
   <link href='//fonts.googleapis.com/css?family=Open+Sans:400,600' rel='stylesheet' type='text/css'> 
   <link href="//fonts.googleapis.com/css?family=Source+Code+Pro:400,700" rel="stylesheet" type="text/css"> 
  <!--<link href="//fonts.useso.com/css?family=Source+Code+Pro:400,700" rel="stylesheet" type="text/css">-->
  <!--<link href='//fonts.useso.com/css?family=Open+Sans:300,600' rel='stylesheet' type='text/css'>-->
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-61404022-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="header-outer" class="outer">
    <a href="/" class="logo">Bigruan Blog</a>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about/index.html">About</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.bigruan.com"></form>
        </div>
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
        
        
          <a id="nav-github-link" class="nav-icon" href="https://github.com/ruanyl" title="Fork me on GitHub"></a>
        
      </nav>
    </div>
  </div>
</header>
      <nav id="mobile-nav" class="off">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about/index.html" class="mobile-nav-link">About</a>
  
  <div id="search-form-wrap-mobile">
    <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.bigruan.com"></form>
  </div>
</nav>
      <div class="outer">
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CSS/">CSS</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JS/">JS</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Javascript/">Javascript</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Others/">Others</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Server/">Server</a><span class="category-list-count">4</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">January 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/03/">March 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/02/">February 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/01/">January 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">December 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">January 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/02/">February 2012</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/01/">January 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/05/">May 2011</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2015-12-14-Use-browserify-with-legacy-libs/">Use browserify with legacy libs</a>
          </li>
        
          <li>
            <a href="/2015-10-06-Continuous-deploy-your-private-repo-from-github/">Continuous Deploy Your Private Repo From Github</a>
          </li>
        
          <li>
            <a href="/2015-09-14-Write-shippable-react-component-with-css-module/">Write React Component with CSS Module</a>
          </li>
        
          <li>
            <a href="/2015-07-14-A-Git-Workflow-for-Selective-Merge-Deployment/">A Git Workflow for Selective Merge Deployment</a>
          </li>
        
          <li>
            <a href="/2015-03-28-The-Secret-Of-Character-Encoding-And-Character-Set/">The Secret of Character Encoding and Character Set</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CI/">CI</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Css/">Css</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Css-Html/">Css,Html</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Django-Python-Apache/">Django Python Apache</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Encoding/">Encoding</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/">HTTP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Javascript/">Javascript</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/">React</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RegExp/">RegExp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Zsh/">Zsh</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/browserify/">browserify</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CI/" style="font-size: 13.33px;">CI</a> <a href="/tags/Css/" style="font-size: 10px;">Css</a> <a href="/tags/Css-Html/" style="font-size: 10px;">Css,Html</a> <a href="/tags/Django-Python-Apache/" style="font-size: 10px;">Django Python Apache</a> <a href="/tags/Encoding/" style="font-size: 10px;">Encoding</a> <a href="/tags/Git/" style="font-size: 16.67px;">Git</a> <a href="/tags/HTTP/" style="font-size: 10px;">HTTP</a> <a href="/tags/Javascript/" style="font-size: 20px;">Javascript</a> <a href="/tags/React/" style="font-size: 10px;">React</a> <a href="/tags/RegExp/" style="font-size: 10px;">RegExp</a> <a href="/tags/Zsh/" style="font-size: 10px;">Zsh</a> <a href="/tags/browserify/" style="font-size: 10px;">browserify</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">links</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="http://hexo.io">Hexo</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
        <section id="main">
  
    <article id="post-Use-browserify-with-legacy-libs" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015-12-14-Use-browserify-with-legacy-libs/" class="article-date">
  <time datetime="2015-12-14T22:45:19.000Z" itemprop="datePublished">2015-12-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/JS/">JS</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015-12-14-Use-browserify-with-legacy-libs/">Use browserify with legacy libs</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="The_problem_3A"><a href="#The_problem_3A" class="headerlink" title="The problem:"></a>The problem:</h3><p>Browserify makes your frontend javascript more modularized and it helps to organize the frontend codes
much better. But only use browserify is not enough if you are using some legacy libs. Which means such
libs are not qualified for npm publication. for example some libs just simply use a global variable: <code>window.Module</code></p>
<h3 id="Introduce_to_browserify-shim_3A"><a href="#Introduce_to_browserify-shim_3A" class="headerlink" title="Introduce to browserify-shim:"></a>Introduce to browserify-shim:</h3><p>For those libs which expose themselves as <code>window.Module</code>, add the following to your <code>package.json</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#34;browserify&#34;: &#123;&#10;  &#34;transform&#34;: [&#10;    &#34;browserify-shim&#34;&#10;  ]&#10;&#125;,&#10;&#34;browserify-shim&#34;: &#123;&#10;  &#34;module&#34;: &#34;global:Module&#34;,&#10;&#125;</span><br></pre></td></tr></table></figure>
<p>What browserify-shim does here is it replaces:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var module = require(&#39;module&#39;)</span><br></pre></td></tr></table></figure></p>
<p>with:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var module = (typeof window !== &#34;undefined&#34; ? window.Module : typeof global !== &#34;undefined&#34; ? global.Module : null)</span><br></pre></td></tr></table></figure></p>
<p><a href="https://github.com/thlorenz/browserify-shim#why-not-just-var-three--windowthree" target="_blank" rel="external">Why not just use var module = window.module</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.bigruan.com/2015-12-14-Use-browserify-with-legacy-libs/" data-id="cik8nopel0000rac9t629d09j" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/browserify/">browserify</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Continuous-deploy-your-private-repo-from-github" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015-10-06-Continuous-deploy-your-private-repo-from-github/" class="article-date">
  <time datetime="2015-10-06T23:25:19.000Z" itemprop="datePublished">2015-10-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Server/">Server</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015-10-06-Continuous-deploy-your-private-repo-from-github/">Continuous Deploy Your Private Repo From Github</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Assume_3A"><a href="#Assume_3A" class="headerlink" title="Assume:"></a>Assume:</h3><ol>
<li>You have a private repo at Github</li>
<li>You have a VPS(Ubuntu 14.04), e.g.,DigitalOcean</li>
<li>It’s a Nodejs project, which means that you need to run npm</li>
<li>You use <code>gulp</code> or <code>grunt</code> or whatever building tools</li>
<li>Your app is running under <code>Apache2</code>, it means the default user <code>www-data</code> of <code>Apache</code> don’t have permission to run some command.</li>
</ol>
<h3 id="You_want_3A"><a href="#You_want_3A" class="headerlink" title="You want:"></a>You want:</h3><p>Every time there is push, deploy it to your VPS and run building scripts.</p>
<h3 id="Steps_3A"><a href="#Steps_3A" class="headerlink" title="Steps:"></a>Steps:</h3><ol>
<li><p>Make sure owner of <em>/var/www/</em> is <em>www-data</em> (default Apache user). If not</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chown -R www-data:www-data /var/www/</span><br></pre></td></tr></table></figure>
</li>
<li><p>Do ssh authentication for git, so that it won’t ask for user&amp;pass</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sudo -Hu www-data mkdir /var/www/.ssh</span><br><span class="line">sudo -Hu www-data ssh-keygen -t rsa -C <span class="string">"your@email.com"</span> <span class="comment"># use your github email</span></span><br><span class="line">sudo -Hu www-data cat /var/www/.ssh/id_rsa.pub <span class="comment">#copy it</span></span><br><span class="line">open https://github.com/settings/ssh <span class="comment">#paste the ssh key here</span></span><br><span class="line"><span class="comment"># clone the repo use ssh url:</span></span><br><span class="line">git <span class="built_in">clone</span> git@github.com:&lt;user&gt;/&lt;repo&gt;.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># type *ssh -T git@github.com* if you see something like:</span></span><br><span class="line">Hi username! You<span class="string">'ve successfully authenticated, but GitHub does not provide shell access.</span><br><span class="line"># you are now authenticated!</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Upgrade nodejs to a proper version</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install nodejs</span><br><span class="line">sudo apt-get install npm</span><br><span class="line"></span><br><span class="line">sudo npm cache clean <span class="operator">-f</span></span><br><span class="line">sudo npm install -g n</span><br><span class="line">sudo n stable</span><br><span class="line">sudo ln -sf /usr/<span class="built_in">local</span>/n/versions/node/&lt;VERSION&gt;/bin/node /usr/bin/node</span><br></pre></td></tr></table></figure>
</li>
<li><p>Let <em>www-data</em> has permission to run <em>npm</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo visudo</span><br><span class="line"><span class="comment"># add this to the file</span></span><br><span class="line">www-data    ALL=NOPASSWD: /usr/bin/npm</span><br></pre></td></tr></table></figure>
</li>
<li><p>Add webhook to your private repo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">open https://github.com/&#60;user&#62;/&#60;repo&#62;/settings/hooks/new&#10;add the link to your deploy script, for example:&#10;http://your.domain/deploy.php</span><br></pre></td></tr></table></figure>
</li>
<li><p>Add <em>deploy.php</em></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">&lt;?php</span></span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="variable">$payload</span> = json_decode(<span class="variable">$_REQUEST</span>[<span class="string">'payload'</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span>(<span class="keyword">Exception</span> <span class="variable">$e</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//log the request</span></span><br><span class="line">file_put_contents(<span class="string">'logs/github.txt'</span>, print_r(<span class="variable">$payload</span>, <span class="keyword">TRUE</span>), FILE_APPEND);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$payload</span>-&gt;ref === <span class="string">'refs/heads/master'</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// path to your site deployment script</span></span><br><span class="line">  exec(<span class="string">'./build.sh'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="preprocessor">?&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>e.g.,build.sh
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line"><span class="built_in">cd</span> /var/www/oupai365/</span><br><span class="line"></span><br><span class="line">git pull origin master</span><br><span class="line">npm install</span><br><span class="line">./node_modules/bower/bin/bower install</span><br><span class="line">./node_modules/gulp/bin/gulp.js vendor</span><br><span class="line">./node_modules/gulp/bin/gulp.js build</span><br><span class="line">./node_modules/gulp/bin/gulp.js</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.bigruan.com/2015-10-06-Continuous-deploy-your-private-repo-from-github/" data-id="cik8nopf90005rac9syeueuly" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CI/">CI</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Write-shippable-react-component-with-css-module" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015-09-14-Write-shippable-react-component-with-css-module/" class="article-date">
  <time datetime="2015-09-14T21:25:19.000Z" itemprop="datePublished">2015-09-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/JS/">JS</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015-09-14-Write-shippable-react-component-with-css-module/">Write React Component with CSS Module</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="The_goals_3A"><a href="#The_goals_3A" class="headerlink" title="The goals:"></a>The goals:</h3><ol>
<li>The component can be published to npmjs.org</li>
<li>No need to incldude css manually on page</li>
<li>Instead of using inline css, now we use Class Name</li>
</ol>
<p><a href="https://github.com/ruanyl/react-slim-progress-webpack" target="_blank" rel="external">sample code</a></p>
<p>Think about that you made an awesome React component,  you don’t just want to use it in your own project but also want to publish
to <code>npm</code> to share with others. However, awesome ui can not live without css. So you either use a bunch of inline css, or write in
the README to tell people who use this component to also include an external css file. This is really not a good idea to write
isolate React Component.</p>
<p>Here we introduce <a href="http://glenmaddern.com/articles/css-modules" target="_blank" rel="external">CSS Modules</a>. The idea is that you can <code>import</code> a css file as it is
a normal <code>npm</code> module. In the we will use <a href="https://github.com/gajus/react-css-modules" target="_blank" rel="external">react-css-modules</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">'./style.css'</span>;</span><br><span class="line"><span class="keyword">import</span> cssModules <span class="keyword">from</span> <span class="string">'react-css-modules'</span>;</span><br></pre></td></tr></table></figure>
<p>Then you can use the css class name in your <code>jsx</code> code. for example in our example you will find:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Progress</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="comment">// find detailed code from source</span></span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">styleName</span>=<span class="value">'progress'</span> <span class="attribute">style</span>=<span class="value">&#123;progressStyle&#125;</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span>;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>You use <code>styleName</code> attribute and the value is just the pure class name you defined in style.css.</p>
<p>Finally, you will need to wrap the component with CSSModules
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> cssModules(Progress, styles);</span><br></pre></td></tr></table></figure></p>
<p>Basically that’s it. But in order to make this component works, you will need to do some webpack settings.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">  loader: ExtractTextPlugin.extract(<span class="string">'style'</span>, <span class="string">'css?modules&amp;importLoaders=1&amp;localIdentName=[name]__[local]___[hash:base64:5]'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>find more from the <a href="https://github.com/ruanyl/react-slim-progress-webpack" target="_blank" rel="external">source code</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.bigruan.com/2015-09-14-Write-shippable-react-component-with-css-module/" data-id="cik8nopfc000arac9w9lfy5qj" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/">React</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-A-Git-Workflow-for-Selective-Merge-Deployment" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015-07-14-A-Git-Workflow-for-Selective-Merge-Deployment/" class="article-date">
  <time datetime="2015-07-14T14:38:19.000Z" itemprop="datePublished">2015-07-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Git/">Git</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015-07-14-A-Git-Workflow-for-Selective-Merge-Deployment/">A Git Workflow for Selective Merge Deployment</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>A decent Git workflow can save your time and make your life easier when collaborating with team members. There are several well known git workflow in the wild.
<a href="https://www.atlassian.com/git/tutorials/comparing-workflows" target="_blank" rel="external">Centralized Workflow</a>, <a href="https://www.atlassian.com/git/tutorials/comparing-workflows/feature-branch-workflow" target="_blank" rel="external">Feature Branch Workflow</a>,
<a href="https://www.atlassian.com/git/tutorials/comparing-workflows/gitflow-workflow" target="_blank" rel="external">Gitflow Workflow</a>, <a href="https://www.atlassian.com/git/tutorials/comparing-workflows/forking-workflow" target="_blank" rel="external">Forking Workflow</a></p>
<p>They fit for different size of project and team. <em>Gitflow</em> is widely use in the larger team and it handles a more complicated scenario. It basically has two branches, <em>master</em> is the production branch,
and <em>develop</em> is the branch which all the <em>feature</em> branches be merged to. When new features are enough for next release or it’s getting to the next release date, creating a <em>release</em> branch from <em>develop</em>. From now 
on, no new features should be merged to <em>release</em> except bugfixes. A <em>hotfix</em> branch should be created from <em>master</em>, and be mergerd back to <em>master</em> and <em>develop</em>.</p>
<p>But for the team which has the requirements that not all the features need to go to production in the next release. It is a little difficult to handle this case because all the commits from <em>feature</em> branch are merged
into <em>develop</em>. This is a real world scenario for those team who has <em>QA</em> environment. Because all the features should be in this branch and be well tested in this environment.</p>
<p>Cherry-pick from develop to master may work but it’s not decent enough and you need to do it carefully in order not to forget some commits. So here comes out a Variant version of gitflow which takes selective merge 
into consideration.</p>
<p><img src="/images/new_git_flow.png" alt="gitflow_new"></p>
<ul>
<li>A new branch <em>staging</em> is created from <em>master</em>. This branch should never be touched until the next release. In another word, <em>master</em> and <em>staging</em> should be always the same.</li>
<li>Feature branches should be created from <em>staging</em>.</li>
<li><em>dev/qa</em> branch should be initially created from <em>staging</em>.</li>
<li>When feature is done, merge it to <em>dev/qa</em> for QA testing.</li>
<li>For features which are going to involved in the next release, send pull request from <em>feature</em> to <em>staging</em> and the reviewer should review and merge it.</li>
<li>Always create <em>hotfix</em> branch from master and merge it back when bug resolved. Also remember to merge it to <em>staging</em> and do <em>cherry-pick</em> from <em>dev/qa</em> so that the fixes are applied to both environment. If needed, send pull request from hotfix to master and staging.</li>
<li>When <em>staging</em> is ready for production, merge it to <em>master</em> and give it a tag.</li>
</ul>
<h4 id="Notice"><a href="#Notice" class="headerlink" title="Notice"></a>Notice</h4><ul>
<li>Merging feature branches from <em>dev/qa</em> and resoving the conflicts there. DO NOT do this at feature branch.</li>
<li>Remember the hotfix and apply it to both <em>staging</em> and <em>dev/qa</em>.</li>
<li>Alway send pull request from <em>feature</em> to <em>staging</em>, so that the reviewers can review and merge it.</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.bigruan.com/2015-07-14-A-Git-Workflow-for-Selective-Merge-Deployment/" data-id="cik8nopff000erac9uzumzpjy" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Git/">Git</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-The-Secret-Of-Character-Encoding-And-Character-Set" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015-03-28-The-Secret-Of-Character-Encoding-And-Character-Set/" class="article-date">
  <time datetime="2015-03-28T23:29:14.000Z" itemprop="datePublished">2015-03-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Others/">Others</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015-03-28-The-Secret-Of-Character-Encoding-And-Character-Set/">The Secret of Character Encoding and Character Set</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>It is a common issue that your page get messed up with non-English characters, for example Chinese and some European characters are displayed as ‘??? ???? ?????’ or ‘���� ����’.
Sometimes it’s even worse if you need to communicate with another system that has different character encoding from yours. for example: GBK(GB18030) and UTF-8</p>
<h3 id="What_is_Character_Encoding_and_Character_Set_3F"><a href="#What_is_Character_Encoding_and_Character_Set_3F" class="headerlink" title="What is Character Encoding and Character Set?"></a>What is Character Encoding and Character Set?</h3><p>Some concepts we need to make clear before we continue. People usually dont have a clear distinction between Character Encoding and Character Sets.
Someone may even ask what’s the difference between UTF-8 and Unicode.</p>
<p><em>Unicode</em> is a Character Set, just as the name says, it’s a set of characters which mapped to a set of unique numbers(code point). for example in the Unicode world,
A is 41, an 1 is 31 and 💩 is 1F4A9</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A --- U+0041&#10;1 --- U+0031&#10;&#128169; --- U+1F4A9</span><br></pre></td></tr></table></figure>
<p>While Character Encoding is a set of mappings between the numbers of Character Sets and the bytes in computer. for example in UTF-8:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">U+0041  --- 01000001&#10;U+0031  --- 00110001&#10;U+1F4A9 --- 11110000 10011111 10010010 10101001</span><br></pre></td></tr></table></figure>
<p>The characters are translated to binary and can be stored in disk or memory now. It’s not that hard, right?</p>
<h3 id="What_are_those_Mysterious__3F_3F_3F_and__uFFFD__3F"><a href="#What_are_those_Mysterious__3F_3F_3F_and__uFFFD__3F" class="headerlink" title="What are those Mysterious ??? and � ?"></a>What are those Mysterious ??? and � ?</h3><p>We know that data are transfered as binary in the wire, so when a browser get the binary data, it have to know what Character Encoding the data was used
so that it can represent the right Character as expected.</p>
<p>So, in a browser you must tell the Character Encoding otherwise the browser will guess or it will use the default Character Encoding and that’s horrible…</p>
<h3 id="Tell_a_browser_what_Character_Encoding_you_are_using"><a href="#Tell_a_browser_what_Character_Encoding_you_are_using" class="headerlink" title="Tell a browser what Character Encoding you are using"></a>Tell a browser what Character Encoding you are using</h3><p>1.Specify Encoding in the http response header</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Type:text/html; charset=UTF-8</span><br></pre></td></tr></table></figure>
<p>In php you can do this by setting the following in php.ini
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">default_charset = &#34;UTF-8&#34;</span><br></pre></td></tr></table></figure></p>
<p>or if you are using Apache server, in httpd.conf and add:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddDefaultCharset utf-8</span><br></pre></td></tr></table></figure></p>
<p>But this is not a good way, think about that if you have a webserver that serves couple of websites with different Encoding(bad idea..)
So a better way could:</p>
<p>2.Use HTML <em>meta</em> tag
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--HTML 4, which default is ISO-8859-1--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">meta</span> <span class="attribute">http-equiv</span>=<span class="value">"Content-Type"</span> <span class="attribute">content</span>=<span class="value">"text/html; charset=utf-8"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--HTML 5, default is UTF-8--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"utf-8"</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="Make_sure_that_your_data_are_well_encoded"><a href="#Make_sure_that_your_data_are_well_encoded" class="headerlink" title="Make sure that your data are well encoded"></a>Make sure that your data are well encoded</h3><p>You have told the browser what Encoding you are using. What if you are using mixed Encoding in your server side? That could be happened.</p>
<p>for example you have page a.php which file encoding is utf-8 but it read some content from a file which is another file encoding,
for example GB18030(GBK)
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#60;?php&#10;$req = file_get_contents(&#39;test.txt&#39;); // test.txt is in GB18030(GBK)&#10;?&#62;&#10;&#60;html&#62;&#10;    &#60;head&#62;&#10;        &#60;meta http-equiv=&#34;Content-Type&#34; content=&#34;text/html; charset=utf8&#34;/&#62;&#10;        &#60;title&#62;index&#60;/title&#62;&#10;    &#60;/head&#62;&#10;    &#60;body&#62;&#10;        &#60;form id=&#34;tForm&#34; action=&#34;/form.php&#34; method=&#34;GET&#34; accept-charset=&#34;utf-8&#34; enctype=&#34;multipart/form-data&#34;&#62;&#10;        &#36755;&#20837;&#65306;&#60;input type=&#34;text&#34; name=&#34;req&#34; value=&#34;&#60;?=$req?&#62;&#34;/&#62;&#10;        &#60;/form&#62;&#10;    &#60;/body&#62;&#10;&#60;/html&#62;</span><br></pre></td></tr></table></figure></p>
<p>you will see part of the page is correct but the input value maybe incorrect. Now when you submit the form, the server will never get the right value.
And think about reading a database with different encoding? That’s terrible right?</p>
<p>There are thousands of articles that suggest to use UTF-8 and Unicode, so please do that to make yours and others life easy.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.bigruan.com/2015-03-28-The-Secret-Of-Character-Encoding-And-Character-Set/" data-id="cik8nopfi000jrac96czzuncz" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Encoding/">Encoding</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Continuous-Integration-Your-Hexo-Blog-With-TravisCI" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015-03-09-Continuous-Integration-Your-Hexo-Blog-With-TravisCI/" class="article-date">
  <time datetime="2015-03-09T09:47:20.000Z" itemprop="datePublished">2015-03-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Javascript/">Javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015-03-09-Continuous-Integration-Your-Hexo-Blog-With-TravisCI/">Continuous Integration Your Hexo Blog With Travis CI</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Everything works fine after migrating my blog to <a href="http://hexo.io" target="_blank" rel="external">hexo</a>, it’s just not cool that everytime I have to run <em>hexo deploy</em> to publish my posts.
Cool boy uses Travis-CI, right?</p>
<h3 id="Step_1_-_generate_a_personal_access_token_at_Github"><a href="#Step_1_-_generate_a_personal_access_token_at_Github" class="headerlink" title="Step 1 - generate a personal access token at Github"></a>Step 1 - generate a personal access token at Github</h3><p>Go to <a href="https://github.com/settings/applications#personal-access-tokens" target="_blank" rel="external">https://github.com/settings/applications#personal-access-tokens</a> and Generate new token</p>
<h3 id="Step_2_-_add_an_environment_variable_to_your_Travis-CI_project"><a href="#Step_2_-_add_an_environment_variable_to_your_Travis-CI_project" class="headerlink" title="Step 2 - add an environment variable to your Travis-CI project."></a>Step 2 - add an environment variable to your Travis-CI project.</h3><ol>
<li>Go to project Settings and choose Environment Variables</li>
<li>Variable Name: DEPLOY_REPO</li>
<li>Variable Value: <a href="https://{github_access_token}@github.com/{github_username}/{repository_name}.git" target="_blank" rel="external">https://{github_access_token}@github.com/{github_username}/{repository_name}.git</a> (for example: <a href="https://8260b82839xx2d19387a51bafca4d5425da7@github.com/ruanyl/ruanyl.github.io.git" target="_blank" rel="external">https://8260b82839xx2d19387a51bafca4d5425da7@github.com/ruanyl/ruanyl.github.io.git</a>)</li>
</ol>
<h3 id="Step_3_-_edit_-travis-yml_file"><a href="#Step_3_-_edit_-travis-yml_file" class="headerlink" title="Step 3 - edit .travis.yml file"></a>Step 3 - edit .travis.yml file</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">language: node_js</span><br><span class="line">node_js:</span><br><span class="line">    - <span class="string">"0.12"</span></span><br><span class="line"></span><br><span class="line">before_install:</span><br><span class="line">    - npm install -g hexo</span><br><span class="line"></span><br><span class="line">install:</span><br><span class="line">    - npm install</span><br><span class="line"></span><br><span class="line">before_script:</span><br><span class="line">    - git config --global user.name <span class="string">'ruanyl'</span></span><br><span class="line">    - git config --global user.email <span class="string">'ruanyu1@gmail.com'</span></span><br><span class="line"></span><br><span class="line">script:</span><br><span class="line">    - hexo generate</span><br><span class="line"></span><br><span class="line">after_success:</span><br><span class="line">    - mkdir .deploy</span><br><span class="line">    - <span class="built_in">cd</span> .deploy</span><br><span class="line">    - git init</span><br><span class="line">    - git remote add origin <span class="variable">$DEPLOY_REPO</span></span><br><span class="line">    - cp -r ../public/* .</span><br><span class="line">    - git add -A .</span><br><span class="line">    - git commit -m <span class="string">'Site updated'</span></span><br><span class="line">    - git push --force --quiet origin master</span><br></pre></td></tr></table></figure>
<h3 id="Notice_21_If_you_have_3rd_party_themes_installed"><a href="#Notice_21_If_you_have_3rd_party_themes_installed" class="headerlink" title="Notice! If you have 3rd party themes installed"></a>Notice! If you have 3rd party themes installed</h3><p>You have to add the theme repo as a gitmodule, add a file named: .gitmodules under the root dir of your hexo blog and add:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[submodule <span class="string">"alex"</span>]</span><br><span class="line">    path = themes/alex</span><br><span class="line">    url = https://github.com/ruanyl/hexo-theme-alex.git</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.bigruan.com/2015-03-09-Continuous-Integration-Your-Hexo-Blog-With-TravisCI/" data-id="cik8nopfm000orac9vqu8pgmo" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CI/">CI</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Javascript-Regular_Expression-In-Detail" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015-03-07-Javascript-Regular_Expression-In-Detail/" class="article-date">
  <time datetime="2015-03-07T09:21:30.000Z" itemprop="datePublished">2015-03-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Javascript/">Javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015-03-07-Javascript-Regular_Expression-In-Detail/">Javascript Regular Expression in Detail</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Regular Expression is widely used in the programmig world but it may not been used so frequently in someone’s daily work. Like me, sometime i forgot
the syntax of Regular Expression or just not able to recall the relevant Javascript functions. Then i will need to search the Regular Expression manual and
read Javascript references. This post will cover some of the commonly used functions of Regular Expression in Javascript.</p>
<h3 id="Creating_a_Regular_Expression"><a href="#Creating_a_Regular_Expression" class="headerlink" title="Creating a Regular Expression"></a>Creating a Regular Expression</h3><p>There are two ways to create a Regular Expression in Javascript: a <em>literal notation</em> and a <em>RegExp constructor</em>, for example:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/^ab+c$/ig</span>; <span class="comment">// literal notation: /pattern/flags</span></span><br><span class="line"><span class="keyword">var</span> regex = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'^ab+c$'</span>, <span class="string">'ig'</span>); <span class="comment">// RegExp constructor: new RegExp(pattern[, flags])</span></span><br></pre></td></tr></table></figure>
<h4 id="Pattern_string"><a href="#Pattern_string" class="headerlink" title="Pattern string"></a>Pattern string</h4><p>When use literal notation, pattern is surrounded with two slash <em>/pattern/</em> while in RegExp constructor it’s a normal string, but notice that when using 
constructor way the pattern string should be escaped. for example:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/\d+/</span>;</span><br><span class="line"><span class="keyword">var</span> regex = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'\\d+'</span>); <span class="comment">// double back slash are used</span></span><br></pre></td></tr></table></figure>
<h4 id="Flags"><a href="#Flags" class="headerlink" title="Flags"></a>Flags</h4><p>A flag can be any of the combination of the following values:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i <span class="comment">//ignore cases</span></span><br><span class="line">g <span class="comment">//global match</span></span><br><span class="line">m <span class="comment">//multiline; treat beginning and end characters (^ and $) as working over multiple lines</span></span><br></pre></td></tr></table></figure>
<p>See details at <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp" target="_blank" rel="external">MND</a></p>
<h3 id="Methods_you_should_know"><a href="#Methods_you_should_know" class="headerlink" title="Methods you should know"></a>Methods you should know</h3><h4 id="1-RegExp-prototype-test_28_29"><a href="#1-RegExp-prototype-test_28_29" class="headerlink" title="1.RegExp.prototype.test()"></a>1.RegExp.prototype.test()</h4><p>If you simply want to find whether a pattern is found in a string, test() method would be a good choice. It returns true or false.</p>
<p>For example: test if a string has a pattern
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/^ab+c/</span>;</span><br><span class="line">regex.test(<span class="string">'abcdef'</span>); <span class="comment">//true</span></span><br></pre></td></tr></table></figure></p>
<p>What if you want to find out how many times a pattern appears in a tring?
Another important property you should know about RegExp object: <em>RegExp.lastIndex</em>.
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// find out how many times a number group appears in a string</span></span><br><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/\d+/g</span>; <span class="comment">// with g flag!</span></span><br><span class="line"><span class="keyword">var</span> str = <span class="string">'aa23bb22cc1dd'</span>;</span><br><span class="line"><span class="keyword">var</span> num = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (regex.test(str) !== <span class="literal">false</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> msg = <span class="string">'Next match starts at '</span> + regex.lastIndex;</span><br><span class="line">  num++;</span><br><span class="line">  <span class="built_in">console</span>.log(msg);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'There are '</span> + num + <span class="string">' groups of number in this string'</span>); <span class="comment">// num = 3</span></span><br></pre></td></tr></table></figure></p>
<p>You can find that value of <em>lastIndex</em> updated when everytime run test() method. 
<em>But! NOTICE!! lastIndex updated ONLY IF you have ‘g’ flag in your Regular Expression.</em></p>
<h4 id="2-RegExp-prototype-exec_28_29"><a href="#2-RegExp-prototype-exec_28_29" class="headerlink" title="2.RegExp.prototype.exec()"></a>2.RegExp.prototype.exec()</h4><p>The exec() method take a string and execute the a search on this string. It return an Array or null.</p>
<p>If you understand the return Array, then you understand most of Javascript RegExp :)</p>
<p>Let see an example in detail. 
Say you want to find out the country code, area code and phone number of a full phone number string. for example: +86-028-84553673
let’s do an stupid simple test ;)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> regex = <span class="regexp">/\+(\d&#123;2&#125;)-(\d&#123;3&#125;)-(\d&#123;8&#125;)/g</span>;</span><br><span class="line"><span class="keyword">var</span> phoneNum = <span class="string">'Tom: +86-028-84553673, Juha: +86-010-23457788'</span>;</span><br><span class="line"><span class="keyword">var</span> result;</span><br><span class="line"><span class="keyword">while</span> ((result = regex.exec(phoneNum)) !== <span class="literal">null</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> msg = <span class="string">'Found '</span> + result[<span class="number">0</span>];</span><br><span class="line">  msg += <span class="string">'\nCountry Code: '</span> + result[<span class="number">1</span>];</span><br><span class="line">  msg += <span class="string">'\nArea code: '</span> + result[<span class="number">2</span>];</span><br><span class="line">  msg += <span class="string">'\nNumber: '</span> + result[<span class="number">3</span>];</span><br><span class="line">  <span class="built_in">console</span>.log(msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Output:
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Found +<span class="number">86</span>-<span class="number">028</span>-<span class="number">84553673</span></span><br><span class="line">Country Code: <span class="number">86</span></span><br><span class="line">Area code: <span class="number">028</span></span><br><span class="line">Number: <span class="number">84553673</span></span><br><span class="line">Found +<span class="number">86</span>-<span class="number">010</span>-<span class="number">23457788</span></span><br><span class="line">Country Code: <span class="number">86</span></span><br><span class="line">Area code: <span class="number">010</span></span><br><span class="line">Number: <span class="number">23457788</span></span><br></pre></td></tr></table></figure></p>
<p>Let’s take a look at the <em>result</em> object:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">result[<span class="number">0</span>]       : the full string that matched the pattern</span><br><span class="line">result[<span class="number">1</span>]...[n] : the pattern that you are willing to preserve <span class="built_in">which</span> you placed <span class="keyword">in</span> Parentheses ()</span><br></pre></td></tr></table></figure>
<p>That’t it!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.bigruan.com/2015-03-07-Javascript-Regular_Expression-In-Detail/" data-id="cik8nopfr000srac90t4wtc17" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/RegExp/">RegExp</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-understanding-CORS" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015-01-20-understanding-CORS/" class="article-date">
  <time datetime="2015-01-20T21:51:22.000Z" itemprop="datePublished">2015-01-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Server/">Server</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015-01-20-understanding-CORS/">Understanding CORS</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="What_is_CORS_3F"><a href="#What_is_CORS_3F" class="headerlink" title="What is CORS?"></a>What is CORS?</h4><p>CORS stands for Cross Origin Resouce Sharing. It means that requests for resources from another domain than the domain where the requests are making.</p>
<p>For security reasons, some HTTP requests are restricted by <a href="https://developer.mozilla.org/en/Same_origin_policy_for_JavaScript" target="_blank" rel="external">same origin policy</a>. For example an Ajax request, we can not make ajax request from domainA.com to request resource from domainB.com. But this could be painful if you are making a restful API which you host your API in another domain like: api.mydeomain.com.</p>
<h4 id="When_it_is_used_3F"><a href="#When_it_is_used_3F" class="headerlink" title="When it is used?"></a>When it is used?</h4><p>As described in MDN:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Invocations of the XMLHttpRequest API in a cross-site manner, as discussed above.&#10;Web Fonts (for cross-domain font usage in @font-face within CSS)&#10;WebGL textures.&#10;Images drawn to a canvas using drawImage.</span><br></pre></td></tr></table></figure>
<h4 id="How_it_work_3F"><a href="#How_it_work_3F" class="headerlink" title="How it work?"></a>How it work?</h4><p>Here we talk about two kinds of cross-site request. They are <em>simple requests</em> and <em>preflight request</em>.</p>
<p>Simple request behaviour:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Client: Hey man, can I take/put some apples from/to your storage?&#10;Server: No. --end</span><br></pre></td></tr></table></figure>
<p>Preflight request behabiour:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Client: Hey man, can I take/put something from/to your storage?&#10;Server: Yes please. (or No --end)&#10;Client: Cool! Please give me some apples.</span><br></pre></td></tr></table></figure>
<p>A simple cross-site request is one that(MDN):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Only uses GET, HEAD or POST. If POST is used to send data to the server, the Content-Type of the data sent to the server with the HTTP POST request is one of application/x-www-form-urlencoded, multipart/form-data, or text/plain.&#10;Does not set custom headers with the HTTP Request (such as X-Modified, etc.)</span><br></pre></td></tr></table></figure>
<p>Otherwise, it is a Preflight request. But, how a simple request actually looks like?</p>
<p>Take a simple GET request for example, if you open chrome dev tool and you will find something like this from http <em>request</em> headers:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /account/user/ HTTP/1.1&#10;...&#10;...&#10;Origin: http://client.localhost</span><br></pre></td></tr></table></figure>
<p>It tells the server: I am from <a href="http://client.localhost" target="_blank" rel="external">http://client.localhost</a> and I want to get user infomation(/account/user/).</p>
<p>Then server <em>response</em>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK&#10;...&#10;...&#10;Access-Control-Allow-Origin: *&#10;Content-Type: application/json&#10;&#10;[json data]</span><br></pre></td></tr></table></figure>
<p>It tells the client: we allow anyone(as you can see:Access-Control-Allow-Origin: *) came to take user data from here and here is the data. If there is no Access-Control-Allow-Origin provided in response header, the browser will give you an error.</p>
<p>Preflight request is a little different. Client actually will have two requests. The first request is send with ‘OPTIONS’ method. If success, then make the actuall request. Take a POST request for an example:</p>
<p>First it makes a OPTIONS request:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OPTIONS /save/user/ HTTP/1.1&#10;...&#10;...&#10;Origin: http://client.localhost&#10;Access-Control-Request-Method: POST</span><br></pre></td></tr></table></figure>
<p>It ‘test’ the server to see if it allows the origin domain and request method for the specific route.</p>
<p>Then the server response:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK&#10;...&#10;...&#10;Access-Control-Allow-Origin: http://client.localhost&#10;Access-Control-Allow-Methods: POST, GET, OPTIONS&#10;Access-Control-Max-Age:3600</span><br></pre></td></tr></table></figure>
<p>Server says OK, you are allowed and can use POST,GET,OPTIONS methods</p>
<p>Finally make the actuall POST request:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST /save/user/ HTTP/1.1&#10;...&#10;...&#10;Content-Type:application/json;charset=UTF-8&#10;Origin:http://client.localhost</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.bigruan.com/2015-01-20-understanding-CORS/" data-id="cik8nopfw000wrac9nc9efv9t" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HTTP/">HTTP</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-How-to-use-git-to-patch-fixes" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014-12-17-How-to-use-git-to-patch-fixes/" class="article-date">
  <time datetime="2014-12-17T19:58:22.000Z" itemprop="datePublished">2014-12-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Git/">Git</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014-12-17-How-to-use-git-to-patch-fixes/">How to use git to patch fixes</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="How_to_use_git_to_patch_fixes_3F"><a href="#How_to_use_git_to_patch_fixes_3F" class="headerlink" title="How to use git to patch fixes?"></a>How to use git to patch fixes?</h2><p>If you need to apply patches from a new release of an open source software that used in your project. However, you lost all the git history of the original repo(for example download release.tar.gz directly) or you just want to apply some of those Fixed commits. Then <em>git format-patch</em> probably a good choice.</p>
<h3 id="Creating_the_patch"><a href="#Creating_the_patch" class="headerlink" title="Creating the patch"></a>Creating the patch</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git format-patch --signoff --binary <span class="number">55</span>befce..<span class="number">1</span>b30d93</span><br></pre></td></tr></table></figure>
<p>This command means that creating patch from commit ‘55befce’ to ‘1b30d93’. And –binary will output a binary diff that you can use to apply the changes to binary file. Actually, –binary is enabled by default. But the difference is that if you create patch files with –binary, all the patch files will use full index instead of the first handful of characters.</p>
<p>this is the difference when outputting patch files.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">index <span class="number">5150093</span>..ebbca95 <span class="number">100644</span></span><br><span class="line">index <span class="number">51500932980</span>c91ef1e6a656ce01dafbca089d148..ebbca9519e7c742eca5bb58f244e704605155474 <span class="number">100644</span></span><br></pre></td></tr></table></figure>
<p>while if there is no –binary, for those not binary files will use the short one and binary files will use the longer one. So, i guess that’s really doesn’t matter whether use –binary or not.</p>
<p>But if you dont want to output the diff of binary files, use <em>–no-binary</em> instead.</p>
<h3 id="Applying_the_patch"><a href="#Applying_the_patch" class="headerlink" title="Applying the patch"></a>Applying the patch</h3><p>Now you have a list of *.patch files. Run the following command to apply it.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git am -<span class="number">3</span> path/to/*.patch</span><br></pre></td></tr></table></figure>
<p><em>-3</em> means that when git trys to apply this patch, it’ll do a 3-way merge. If there is no conflict, a new commit will be auto commited. if there is conflict, resolve the conflicts then:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git am --continue</span><br></pre></td></tr></table></figure>
<p>If error happened and git can not auto merge the files, you will need to apply the patch manully. Open the patch files and find what has changed, then just do it manully.. Abort the current process first:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git am --abort</span><br></pre></td></tr></table></figure>
<p>when you’ve done it manully, then commit it as normal.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.bigruan.com/2014-12-17-How-to-use-git-to-patch-fixes/" data-id="cik8nopfz0010rac9kn2utpbv" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Git/">Git</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-how-to-use-javascript-sourcemap" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014-07-18-how-to-use-javascript-sourcemap/" class="article-date">
  <time datetime="2014-07-18T00:16:39.000Z" itemprop="datePublished">2014-07-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/JS/">JS</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014-07-18-how-to-use-javascript-sourcemap/">How to use javascriot sourcemap?</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="1-What_is_sourcemap_3F"><a href="#1-What_is_sourcemap_3F" class="headerlink" title="1.What is sourcemap?"></a>1.What is sourcemap?</h3><p>A sourcemap is a file which contains the mapping between the minified(concated, uglified) file and the original files.</p>
<h3 id="2-Why_sourcemap_3F"><a href="#2-Why_sourcemap_3F" class="headerlink" title="2.Why sourcemap?"></a>2.Why sourcemap?</h3><p>If you want to keep your client side code readable and easy to debug after compressing, sourcemap will play tricks.</p>
<h3 id="3-How_to_use_sourcemap_3F"><a href="#3-How_to_use_sourcemap_3F" class="headerlink" title="3.How to use sourcemap?"></a>3.How to use sourcemap?</h3><p>1.Enable sourcemap in chrome dev tools.</p>
<p>2.Generate sourcemap by using gulp(or grunt or whatever tools you like)</p>
<p>here is a sample configuration of Gulpjs.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> concat = <span class="built_in">require</span>(<span class="string">'gulp-concat'</span>);</span><br><span class="line"><span class="keyword">var</span> uglify = <span class="built_in">require</span>(<span class="string">'gulp-uglify'</span>);</span><br><span class="line"><span class="keyword">var</span> sourcemaps = <span class="built_in">require</span>(<span class="string">'gulp-sourcemaps'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> paths = &#123;</span><br><span class="line">  scripts: <span class="string">'src/**/*.js'</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">gulp.task(<span class="string">'scripts'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Minify and copy all JavaScript (except vendor scripts)</span></span><br><span class="line">  <span class="comment">// with sourcemaps all the way down</span></span><br><span class="line">  <span class="keyword">return</span> gulp.src(paths.scripts)</span><br><span class="line">    .pipe(sourcemaps.init())</span><br><span class="line">      .pipe(concat(<span class="string">'all.js'</span>))</span><br><span class="line">      .pipe(uglify())</span><br><span class="line">    .pipe(sourcemaps.write())</span><br><span class="line">    .pipe(gulp.dest(<span class="string">'build/js'</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Rerun the task when a file changes</span></span><br><span class="line">gulp.task(<span class="string">'watch'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  gulp.watch(paths.scripts, [<span class="string">'scripts'</span>]);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// The default task (called when you run `gulp` from cli)</span></span><br><span class="line">gulp.task(<span class="string">'default'</span>, [<span class="string">'watch'</span>, <span class="string">'scripts'</span>]);</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.bigruan.com/2014-07-18-how-to-use-javascript-sourcemap/" data-id="cik8nopg10013rac9xrgjliv3" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li></ul>

    </footer>
  </div>
  
</article>


  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</section>
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <a href="/" class="logo">Bigruan Blog</a>
      &copy; 2016 Bigruan<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    

<script src="/js/jquery.min.js" type="text/javascript"></script>
<script src="/js/jquery.scrollLoading.js" type="text/javascript"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>
